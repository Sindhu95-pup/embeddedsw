<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>xilloader: xloader_auth_enc.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="HTML_custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="xlogo_bg.gif"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">xilloader
   </div>
   <div id="projectbrief">Vitis Drivers API Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Overview</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="globals.html"><span>APIs</span></a></li>
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('xloader__auth__enc_8c.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">xloader_auth_enc.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Overview</h2>
<div class="textblock"><p>This file contains authentication and encryption related code. </p>
<pre>
MODIFICATION HISTORY:</pre><pre>Ver   Who  Date     Changes
----- ---- -------- -------------------------------------------------------
1.00  bm   12/16/20 First release
      kal  12/23/20 Initialize Status to XST_FAILURE in XLoader_AesKatTest
      kpt  01/06/21 Added redundancy for the loop in XLoader_CheckNonZeroPpk
      kpt  01/12/21 Added check to validate keysrc for partitions when
                    DEC only efuse bits are set
      kpt  01/18/21 Added check to validate the index of for loop with lower
                    bounds of ppk offset in XLoader_CheckNonZeroPpk
      har  01/19/21 Added support for P521 KAT
      kpt  01/21/21 Added check to verify revoke id before enabling Auth Jtag
      har  02/01/21 Added check for metaheader encryption source
      bm   02/12/21 Updated logic to use BootHdr directly from PMC RAM
      kpt  02/16/21 Corrected check to return valid error code in case of
                    MetaHeader IV mismatch and fixed gcc warning
      har  03/02/21 Added support to verify IHT as AAD for first secure header
      har  03/17/21 Cleaned up code to use the secure state of boot
      ma   03/24/21 Redirect XilPdi prints to XilLoader
      ma   03/24/21 Minor updates to prints in XilLoader
      bm   04/10/21 Updated scheduler function calls
      kpt  04/14/21 Added check to verify whether the encrypted data is 128 bit
                    aligned
      bm   05/10/21 Updated chunking logic for hashes
      bm   05/13/21 Updated code to use common crypto instances from xilsecure
      ma   05/18/21 Minor code cleanup
      har  05/19/21 Support decryption of partition even if Secure state of
                    boot is A-HWRoT or Emulated A-HWRoT
      ma   05/21/21 Read KAT Status from RTCA Secure Boot State location
1.01  kpt  06/23/21 Added check to compare DNA before enabling Auth Jtag
           07/01/21 Added support to disable Jtag as per the timeout
                    set by user
      td   07/08/21 Fix doxygen warnings
      ma   07/12/21 Register NULL error handler for
                    XLoader_CheckAuthJtagIntStatus scheduler task
      har  07/15/21 Fixed doxygen warnings
      td   07/15/21 Fixed doxygen warnings
      bsv  08/17/21 Code clean up
      rb   08/11/21 Fix compilation warnings
      bm   08/24/2021 Added Extract Metaheader support
      bsv  08/31/21 Code clean up
      kpt  09/02/21 Added support to update KAT status in RTC area
      am   09/09/21 Fixed multiple SPK Authentication while authenticating
                    MetaHeader
      kpt  09/09/21 Fixed SW-BP-BLIND-WRITE in XLoader_AuthEncClear
      kpt  09/15/21 Modified check for PUF HD in XLoader_SecureEncOnlyValidations
      kpt  09/18/21 Fixed SW-BP-REDUNDANCY
                    Added check in XLoader_CheckAuthJtagIntStatus to avoid access
                    to auth jtag if there is a failure in single attempt
                    Renamed BHSignature variable to IHTSignature
      bsv  10/01/21 Addressed code review comments
1.02  kpt  10/01/21 Removed redundant code in XLoader_VerifyRevokeId
      kpt  10/07/21 Decoupled checksum functionality from secure code
      kpt  10/20/21 Modified temporal checks to use temporal variables from
                    data section
      kpt  10/28/21 Fixed PMCDMA1 hang issue in sbi checksum copy to memory
                    mode
1.03  skd  11/18/21 Added time stamps in XLoader_ProcessAuthEncPrtn
      bsv  12/04/21 Address security review comment
      kpt  12/13/21 Replaced standard library utility functions with xilinx
                    maintained functions
      skd  01/11/22 Moved comments to its proper place
      skd  01/12/22 Updated goto labels for better readability
      bsv  02/09/22 Code clean up to reduce stack size
      bsv  02/09/22 Code clean up
      bsv  02/10/22 Code clean up by removing unwanted initializations
      bsv  02/11/22 Code optimization to reduce text size
      bsv  02/13/22 Reduce stack usage of functions
      har  02/17/22 Updated code to limit number of attempts to enable JTAG
                    when efuse bits are set
1.04  skg  06/20/22 Fixed MISRA C Rule 10.3 violation
      bm   07/06/22 Refactor versal and versal_net code
      kpt  07/07/22 Added support to update KAT status
      bsv  07/08/22 Changes related to Optional data in Image header table
      kpt  07/24/22 Added support to go into secure lockdown when KAT fails
      kpt  08/03/22 Added volatile keyword to avoid compiler optimization
                    of loop redundancy checks
1.05  har  10/11/22 Used temporal check macro for redundancy checks for Xil_SMemCpy
      sk   10/19/22 Fix security review comments
      har  11/17/22 Made XLoader_CheckNonZeroPpk as non-static and moved here from <a class="el" href="xloader__secure_8c.html" title="This file contains all common security operations including sha related code. ">xloader_secure.c</a> file
      ng   11/23/22 Updated doxygen comments
1.8   skg  12/07/22 Added Additional PPKs support
      kal  01/05/23 Moved XLoader_GetAuthPubAlgo function to header file
      sk   02/08/23 Renamed XLoader_UpdateKatStatus to XLoader_ClearKatOnPPDI
      sk   02/09/23 Fixed Sec Review comments in XLoader_RsaSignVerify function
1.9   kpt  02/21/23 Fixed bug in XLoader_AuthEncClear
      sk   02/28/23 Removed using of pointer to string literal in XLoader_AuthKat
      sk   03/10/23 Added redundancy for AES Key selection
      sk   03/17/23 Renamed Kekstatus to DecKeySrc in xilpdi structure
      dc   03/30/23 Updated ECDSA authentication logic to support both BE/LE
      ng   03/30/23 Updated algorithm and return values in doxygen comments</pre><pre></pre><dl class="section note"><dt>Note</dt><dd></dd></dl>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ab5e43af745222cb78f6a71853c891183"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xloader__auth__enc_8c.html#ab5e43af745222cb78f6a71853c891183">XLOADER_RSA_PSS_MSB_PADDING_MASK</a>&#160;&#160;&#160;(u8)(0x80U)</td></tr>
<tr class="memdesc:ab5e43af745222cb78f6a71853c891183"><td class="mdescLeft">&#160;</td><td class="mdescRight">RSA PSS MSB padding mask.  <a href="#ab5e43af745222cb78f6a71853c891183">More...</a><br/></td></tr>
<tr class="separator:ab5e43af745222cb78f6a71853c891183"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a98ac029ac7965b392e6bb0097876fd94"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xloader__auth__enc_8c.html#a98ac029ac7965b392e6bb0097876fd94">XLOADER_RSA_EM_MSB_INDEX</a>&#160;&#160;&#160;(0x0U)</td></tr>
<tr class="memdesc:a98ac029ac7965b392e6bb0097876fd94"><td class="mdescLeft">&#160;</td><td class="mdescRight">RSA EM MSB Index.  <a href="#a98ac029ac7965b392e6bb0097876fd94">More...</a><br/></td></tr>
<tr class="separator:a98ac029ac7965b392e6bb0097876fd94"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aad372ad8e543134647457ddfd18128ab"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xloader__auth__enc_8c.html#aad372ad8e543134647457ddfd18128ab">XLOADER_PUF_SHUT_GLB_VAR_FLTR_EN_SHIFT</a>&#160;&#160;&#160;(31U)</td></tr>
<tr class="memdesc:aad372ad8e543134647457ddfd18128ab"><td class="mdescLeft">&#160;</td><td class="mdescRight">Shift for Global Variation Filter in PUF shutter value.  <a href="#aad372ad8e543134647457ddfd18128ab">More...</a><br/></td></tr>
<tr class="separator:aad372ad8e543134647457ddfd18128ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a37451d47afb1549cfd45ae1c5947d579"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xloader__auth__enc_8c.html#a37451d47afb1549cfd45ae1c5947d579">XLOADER_AES_RESET_VAL</a>&#160;&#160;&#160;(0x1U)</td></tr>
<tr class="memdesc:a37451d47afb1549cfd45ae1c5947d579"><td class="mdescLeft">&#160;</td><td class="mdescRight">AES Reset value.  <a href="#a37451d47afb1549cfd45ae1c5947d579">More...</a><br/></td></tr>
<tr class="separator:a37451d47afb1549cfd45ae1c5947d579"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a05d874ef5d60f3bba3fe7e580e2335b4"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xloader__auth__enc_8c.html#a05d874ef5d60f3bba3fe7e580e2335b4">XLOADER_AES_RESET_REG</a>&#160;&#160;&#160;(0xF11E0010U)</td></tr>
<tr class="memdesc:a05d874ef5d60f3bba3fe7e580e2335b4"><td class="mdescLeft">&#160;</td><td class="mdescRight">AES Reset register address.  <a href="#a05d874ef5d60f3bba3fe7e580e2335b4">More...</a><br/></td></tr>
<tr class="separator:a05d874ef5d60f3bba3fe7e580e2335b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8c9cd6721e418777842ed226fedcb2c8"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xloader__auth__enc_8c.html#a8c9cd6721e418777842ed226fedcb2c8">XLOADER_ECDSA_RSA_RESET_REG</a>&#160;&#160;&#160;(0xF1200040U)</td></tr>
<tr class="memdesc:a8c9cd6721e418777842ed226fedcb2c8"><td class="mdescLeft">&#160;</td><td class="mdescRight">ECDSA RSA Reset register address.  <a href="#a8c9cd6721e418777842ed226fedcb2c8">More...</a><br/></td></tr>
<tr class="separator:a8c9cd6721e418777842ed226fedcb2c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8095884006d0bdec587bc2e15157bf33"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xloader__auth__enc_8c.html#a8095884006d0bdec587bc2e15157bf33">XLOADER_ECDSA_RSA_RESET_VAL</a>&#160;&#160;&#160;(0x1U)</td></tr>
<tr class="memdesc:a8095884006d0bdec587bc2e15157bf33"><td class="mdescLeft">&#160;</td><td class="mdescRight">ECDSA RSA Reset value.  <a href="#a8095884006d0bdec587bc2e15157bf33">More...</a><br/></td></tr>
<tr class="separator:a8095884006d0bdec587bc2e15157bf33"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a5aef75ed3205f50c75189b7c46099856"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xloader__auth__enc_8c.html#a5aef75ed3205f50c75189b7c46099856">XLoader_SecureAuthInit</a> (XLoader_SecureParams *SecurePtr, const XilPdi_PrtnHdr *PrtnHdr)</td></tr>
<tr class="memdesc:a5aef75ed3205f50c75189b7c46099856"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function initializes authentication parameters of XLoader_SecureParams's instance.  <a href="#a5aef75ed3205f50c75189b7c46099856">More...</a><br/></td></tr>
<tr class="separator:a5aef75ed3205f50c75189b7c46099856"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9df696fd17dec50576f817a1cd1f7105"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xloader__auth__enc_8c.html#a9df696fd17dec50576f817a1cd1f7105">XLoader_SecureEncInit</a> (XLoader_SecureParams *SecurePtr, const XilPdi_PrtnHdr *PrtnHdr)</td></tr>
<tr class="memdesc:a9df696fd17dec50576f817a1cd1f7105"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function initializes encryption parameters of XLoader_SecureParams's instance.  <a href="#a9df696fd17dec50576f817a1cd1f7105">More...</a><br/></td></tr>
<tr class="separator:a9df696fd17dec50576f817a1cd1f7105"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7d852b900fa863fa8719bba0e2699423"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xloader__auth__enc_8c.html#a7d852b900fa863fa8719bba0e2699423">XLoader_SecureValidations</a> (const XLoader_SecureParams *SecurePtr)</td></tr>
<tr class="memdesc:a7d852b900fa863fa8719bba0e2699423"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function checks if authentication/encryption is compulsory.  <a href="#a7d852b900fa863fa8719bba0e2699423">More...</a><br/></td></tr>
<tr class="separator:a7d852b900fa863fa8719bba0e2699423"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a677a618842a76cb8ee935fd0e5bd18fa"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xloader__auth__enc_8c.html#a677a618842a76cb8ee935fd0e5bd18fa">XLoader_ImgHdrTblAuth</a> (XLoader_SecureParams *SecurePtr)</td></tr>
<tr class="memdesc:a677a618842a76cb8ee935fd0e5bd18fa"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function authenticates the image header table.  <a href="#a677a618842a76cb8ee935fd0e5bd18fa">More...</a><br/></td></tr>
<tr class="separator:a677a618842a76cb8ee935fd0e5bd18fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac4b3b88f124856db12efa0ce4d6c81d0"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xloader__auth__enc_8c.html#ac4b3b88f124856db12efa0ce4d6c81d0">XLoader_ReadAndVerifySecureHdrs</a> (XLoader_SecureParams *SecurePtr, XilPdi_MetaHdr *MetaHdr)</td></tr>
<tr class="memdesc:ac4b3b88f124856db12efa0ce4d6c81d0"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function authenticates and/or decrypts the image headers and partition headers and copies the contents to the corresponding structures.  <a href="#ac4b3b88f124856db12efa0ce4d6c81d0">More...</a><br/></td></tr>
<tr class="separator:ac4b3b88f124856db12efa0ce4d6c81d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6be961c2f80c31d661adab83f62ba790"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xloader__auth__enc_8c.html#a6be961c2f80c31d661adab83f62ba790">XLoader_IsPpkValid</a> (<a class="el" href="xloader__auth__enc_8h.html#a85aba33b166080b4874c0f5657589b3e">XLoader_PpkSel</a> PpkSelect, const u8 *PpkHash)</td></tr>
<tr class="memdesc:a6be961c2f80c31d661adab83f62ba790"><td class="mdescLeft">&#160;</td><td class="mdescRight">The function reads PPK invalid bits.  <a href="#a6be961c2f80c31d661adab83f62ba790">More...</a><br/></td></tr>
<tr class="separator:a6be961c2f80c31d661adab83f62ba790"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac13109c8130393c4720ee21b03509e73"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xloader__auth__enc_8c.html#ac13109c8130393c4720ee21b03509e73">XLoader_RsaPssSignVerify</a> (XPmcDma *PmcDmaInstPtr, u8 *MsgHash, XSecure_Rsa *RsaInstPtr, u8 *Signature)</td></tr>
<tr class="memdesc:ac13109c8130393c4720ee21b03509e73"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function encrypts the RSA signature provided and performs required PSS operations to extract salt and calculates M prime hash and compares with hash obtained from EM.  <a href="#ac13109c8130393c4720ee21b03509e73">More...</a><br/></td></tr>
<tr class="separator:ac13109c8130393c4720ee21b03509e73"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a434f49bc94a9078a86451ac5bde637cc"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xloader__auth__enc_8c.html#a434f49bc94a9078a86451ac5bde637cc">XLoader_AddAuthJtagToScheduler</a> (void)</td></tr>
<tr class="memdesc:a434f49bc94a9078a86451ac5bde637cc"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function adds periodic checks of the status of Auth JTAG interrupt status to the scheduler.  <a href="#a434f49bc94a9078a86451ac5bde637cc">More...</a><br/></td></tr>
<tr class="separator:a434f49bc94a9078a86451ac5bde637cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5ab0ef6b838c9f3d87f5f6566065938a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xloader__auth__enc_8c.html#a5ab0ef6b838c9f3d87f5f6566065938a">XLoader_CheckAuthJtagIntStatus</a> (void *Arg)</td></tr>
<tr class="memdesc:a5ab0ef6b838c9f3d87f5f6566065938a"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function checks the status of Auth JTAG interrupt status and it disables the Jtag as per the timeout set by user.  <a href="#a5ab0ef6b838c9f3d87f5f6566065938a">More...</a><br/></td></tr>
<tr class="separator:a5ab0ef6b838c9f3d87f5f6566065938a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a22f293db863b881993077e17fc892007"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xloader__auth__enc_8c.html#a22f293db863b881993077e17fc892007">XLoader_AuthEncClear</a> (void)</td></tr>
<tr class="memdesc:a22f293db863b881993077e17fc892007"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function is called to clear secure critical data related to authentication and encryption in case of exceptions.  <a href="#a22f293db863b881993077e17fc892007">More...</a><br/></td></tr>
<tr class="separator:a22f293db863b881993077e17fc892007"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a751efbc828bc415c99c4e2302fafe43e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xloader__auth__enc_8c.html#a751efbc828bc415c99c4e2302fafe43e">XLoader_ClearKatOnPPDI</a> (XLoader_SecureParams *SecurePtr, u32 PlmKatMask)</td></tr>
<tr class="memdesc:a751efbc828bc415c99c4e2302fafe43e"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function updates the KAT status.  <a href="#a751efbc828bc415c99c4e2302fafe43e">More...</a><br/></td></tr>
<tr class="separator:a751efbc828bc415c99c4e2302fafe43e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa912487046c04b1c90ca418a19ac3e0d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xloader__auth__enc_8c.html#aa912487046c04b1c90ca418a19ac3e0d">XLoader_ProcessAuthEncPrtn</a> (XLoader_SecureParams *SecurePtr, u64 DestAddr, u32 BlockSize, u8 Last)</td></tr>
<tr class="memdesc:aa912487046c04b1c90ca418a19ac3e0d"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function performs authentication and decryption of the partition.  <a href="#aa912487046c04b1c90ca418a19ac3e0d">More...</a><br/></td></tr>
<tr class="separator:aa912487046c04b1c90ca418a19ac3e0d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a05d874ef5d60f3bba3fe7e580e2335b4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define XLOADER_AES_RESET_REG&#160;&#160;&#160;(0xF11E0010U)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>AES Reset register address. </p>

<p>Referenced by <a class="el" href="xloader__auth__enc_8h.html#a22f293db863b881993077e17fc892007">XLoader_AuthEncClear()</a>.</p>

</div>
</div>
<a class="anchor" id="a37451d47afb1549cfd45ae1c5947d579"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define XLOADER_AES_RESET_VAL&#160;&#160;&#160;(0x1U)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>AES Reset value. </p>

<p>Referenced by <a class="el" href="xloader__auth__enc_8h.html#a22f293db863b881993077e17fc892007">XLoader_AuthEncClear()</a>.</p>

</div>
</div>
<a class="anchor" id="a8c9cd6721e418777842ed226fedcb2c8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define XLOADER_ECDSA_RSA_RESET_REG&#160;&#160;&#160;(0xF1200040U)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>ECDSA RSA Reset register address. </p>

<p>Referenced by <a class="el" href="xloader__auth__enc_8h.html#a22f293db863b881993077e17fc892007">XLoader_AuthEncClear()</a>.</p>

</div>
</div>
<a class="anchor" id="a8095884006d0bdec587bc2e15157bf33"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define XLOADER_ECDSA_RSA_RESET_VAL&#160;&#160;&#160;(0x1U)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>ECDSA RSA Reset value. </p>

<p>Referenced by <a class="el" href="xloader__auth__enc_8h.html#a22f293db863b881993077e17fc892007">XLoader_AuthEncClear()</a>.</p>

</div>
</div>
<a class="anchor" id="aad372ad8e543134647457ddfd18128ab"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define XLOADER_PUF_SHUT_GLB_VAR_FLTR_EN_SHIFT&#160;&#160;&#160;(31U)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Shift for Global Variation Filter in PUF shutter value. </p>

</div>
</div>
<a class="anchor" id="a98ac029ac7965b392e6bb0097876fd94"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define XLOADER_RSA_EM_MSB_INDEX&#160;&#160;&#160;(0x0U)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>RSA EM MSB Index. </p>

<p>Referenced by <a class="el" href="xloader__auth__enc_8h.html#ac13109c8130393c4720ee21b03509e73">XLoader_RsaPssSignVerify()</a>.</p>

</div>
</div>
<a class="anchor" id="ab5e43af745222cb78f6a71853c891183"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define XLOADER_RSA_PSS_MSB_PADDING_MASK&#160;&#160;&#160;(u8)(0x80U)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>RSA PSS MSB padding mask. </p>

<p>Referenced by <a class="el" href="xloader__auth__enc_8h.html#ac13109c8130393c4720ee21b03509e73">XLoader_RsaPssSignVerify()</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a434f49bc94a9078a86451ac5bde637cc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int XLoader_AddAuthJtagToScheduler </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function adds periodic checks of the status of Auth JTAG interrupt status to the scheduler. </p>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>XST_SUCCESS otherwise error code is returned</li>
<li>XLOADER_ERR_GLITCH_DETECTED if glitch is detected.</li>
<li>XLOADER_ERR_ADD_TASK_SCHEDULER if failed to add task to scheduler. </li>
</ul>
</dd></dl>
<ul>
<li>Read auth_jtag_disable efuse bits(20:19) of Security Control register in Efuse Cache module.</li>
<li>Read PPK hash registers in Efuse Cache module and check if they are non-zero.</li>
<li>Check the preconditions for adding task to the scheduler<ul>
<li>Auth jtag disable efuse bits should not be set.</li>
<li>PPK hash registers should be non zero.</li>
</ul>
</li>
<li>If the preconditions are correct then add task to the scheduler for calling the API to check Auth JTAG interrupt status.</li>
<li>The task should not be added to the scheduler if Auth JTAG disable efuse bit is set or PPK hash is not programmed in efuse. Thus forcing the Status to be XST_SUCCESS.</li>
</ul>

<p>References <a class="el" href="xloader__auth__enc_8h.html#a8c675b9a826e78d971cb1638ca5979ee">XLOADER_AUTH_JTAG_DIS_MASK</a>, <a class="el" href="xloader__auth__enc_8c.html#a5ab0ef6b838c9f3d87f5f6566065938a">XLoader_CheckAuthJtagIntStatus()</a>, <a class="el" href="xloader__auth__enc_8h.html#a39a0aa8b95cff74352dd8e9adc16c895">XLOADER_EFUSE_CACHE_SECURITY_CONTROL_OFFSET</a>, and <a class="el" href="xloader__secure_8c.html#a3e99458db1239a8f1bcb70eee9025232">XLoader_GetAHWRoT()</a>.</p>

<p>Referenced by <a class="el" href="xloader_8c.html#acb10f2e97fecfb15aae4fed081b02502">XLoader_Init()</a>.</p>

</div>
</div>
<a class="anchor" id="a22f293db863b881993077e17fc892007"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int XLoader_AuthEncClear </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function is called to clear secure critical data related to authentication and encryption in case of exceptions. </p>
<p>The function also places AES, ECDSA_RSA in reset.</p>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>XST_SUCCESS on success.</li>
<li>XST_FAILURE on failure. </li>
</ul>
</dd></dl>
<ul>
<li>Clear keys.</li>
<li>Place AES in reset and clear AES instance</li>
<li>Hardcoded RSA base address</li>
<li>Release RSA from reset</li>
<li>Clear Rsa memory</li>
<li>Place RSA in reset and clear RSA instance </li>
</ul>

<p>References <a class="el" href="xloader__auth__enc_8c.html#a05d874ef5d60f3bba3fe7e580e2335b4">XLOADER_AES_RESET_REG</a>, <a class="el" href="xloader__auth__enc_8c.html#a37451d47afb1549cfd45ae1c5947d579">XLOADER_AES_RESET_VAL</a>, <a class="el" href="xloader__auth__enc_8c.html#a8c9cd6721e418777842ed226fedcb2c8">XLOADER_ECDSA_RSA_RESET_REG</a>, and <a class="el" href="xloader__auth__enc_8c.html#a8095884006d0bdec587bc2e15157bf33">XLOADER_ECDSA_RSA_RESET_VAL</a>.</p>

<p>Referenced by <a class="el" href="xloader__secure_8h.html#a9171035e129091fbaddbc27756381f76">XLoader_SecureClear()</a>.</p>

</div>
</div>
<a class="anchor" id="a5ab0ef6b838c9f3d87f5f6566065938a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int XLoader_CheckAuthJtagIntStatus </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>Arg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function checks the status of Auth JTAG interrupt status and it disables the Jtag as per the timeout set by user. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Arg</td><td>Not used in the function currently</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>XST_SUCCESS on success.</li>
<li>XLOADER_ERR_AUTH_JTAG_EXCEED_ATTEMPTS if Jtag Authentication failed more than once.</li>
<li>XLOADER_DAP_TIMEOUT_DISABLED if timeout is disabled for DAP.</li>
</ul>
</dd></dl>
<dl class="section note"><dt>Note</dt><dd>If Auth JTAG interrupt status is set, then XLoader_AuthJtag API will be called. </dd></dl>
<ul>
<li>Read Auth Jtag Interrupt Status register in PMC TAP module.</li>
<li>Check if Auth JTAG Lock disable efuse bits are set. If set then allow limited number of attempts to enable JTAG.</li>
</ul>

<p>References <a class="el" href="xloader__auth__enc_8h.html#ad7aca18f25d8240dff6ae1f4d990c39c">XLOADER_AUTH_JTAG_LOCK_DIS_MASK</a>, <a class="el" href="xloader__auth__enc_8h.html#aff8787d6251f3a610514fadf2d015952">XLOADER_AUTH_JTAG_MAX_ATTEMPTS</a>, <a class="el" href="xloader__auth__enc_8h.html#acb423209a22e391e7da668653a6e1e81">XLOADER_DAP_TIMEOUT_DISABLED</a>, <a class="el" href="xloader__auth__enc_8h.html#a39a0aa8b95cff74352dd8e9adc16c895">XLOADER_EFUSE_CACHE_SECURITY_CONTROL_OFFSET</a>, <a class="el" href="xloader__auth__enc_8h.html#aaba63a6911c51f5d3989f3ad318b14e0">XLOADER_PMC_TAP_AUTH_JTAG_INT_STATUS_MASK</a>, and <a class="el" href="xloader__auth__enc_8h.html#acd652535b771e6fea9e9067c174d3273">XLOADER_PMC_TAP_AUTH_JTAG_INT_STATUS_OFFSET</a>.</p>

<p>Referenced by <a class="el" href="xloader__auth__enc_8h.html#a434f49bc94a9078a86451ac5bde637cc">XLoader_AddAuthJtagToScheduler()</a>, and <a class="el" href="net_2xloader__plat_8h.html#a36eeb66375a1d833608e9869ac5e8c25">XLoader_UpdateHandler()</a>.</p>

</div>
</div>
<a class="anchor" id="a751efbc828bc415c99c4e2302fafe43e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void XLoader_ClearKatOnPPDI </td>
          <td>(</td>
          <td class="paramtype">XLoader_SecureParams *&#160;</td>
          <td class="paramname"><em>SecurePtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>PlmKatMask</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function updates the KAT status. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">SecurePtr</td><td>is pointer to the XLoader_SecureParams instance </td></tr>
    <tr><td class="paramname">PlmKatMask</td><td>is the mask of the KAT that is going to run</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>None </li>
</ul>
</dd></dl>

</div>
</div>
<a class="anchor" id="a677a618842a76cb8ee935fd0e5bd18fa"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int XLoader_ImgHdrTblAuth </td>
          <td>(</td>
          <td class="paramtype">XLoader_SecureParams *&#160;</td>
          <td class="paramname"><em>SecurePtr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function authenticates the image header table. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">SecurePtr</td><td>is pointer to the XLoader_SecureParams instance</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>XST_SUCCESS on success.</li>
<li>XLOADER_ERR_IHT_GET_DMA if acquiring DMA is failed.</li>
<li>XLOADER_ERR_IHT_COPY_FAIL if IHT copy fails.</li>
<li>XLOADER_ERR_IHT_HASH_CALC_FAIL if IHT hash calculation fails.</li>
<li>XLOADER_ERR_IHT_AUTH_FAIL if IHT authentication fails. </li>
</ul>
</dd></dl>
<ul>
<li>Get DMA instance</li>
<li>Copy Authentication certificate from PDI to PMCRAM</li>
<li>Calculate SHA-3 hash of the image header table</li>
<li>Authenticate Image header table </li>
</ul>

<p>References <a class="el" href="xloader__auth__enc_8h.html#abf854bbd429c87a80e3a56f61abfd265">XLOADER_AUTH_CERT_MIN_SIZE</a>.</p>

</div>
</div>
<a class="anchor" id="a6be961c2f80c31d661adab83f62ba790"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int XLoader_IsPpkValid </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="xloader__auth__enc_8h.html#a85aba33b166080b4874c0f5657589b3e">XLoader_PpkSel</a>&#160;</td>
          <td class="paramname"><em>PpkSelect</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const u8 *&#160;</td>
          <td class="paramname"><em>PpkHash</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The function reads PPK invalid bits. </p>
<p>If the bits are valid, it compares the provided hash value with the programed hash value. Efuse stores only 256 bits of hash.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">PpkSelect</td><td>PPK selection of eFUSE. </td></tr>
    <tr><td class="paramname">PpkHash</td><td>Pointer to the PPK hash to be verified.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>XST_SUCCESS on success.</li>
<li>XLOADER_SEC_PPK_INVALID_BIT_ERR if invalid PPK bit set.</li>
<li>XLOADER_SEC_PPK_HASH_ALLZERO_INVLD if PPK hash is all zeros. </li>
</ul>
</dd></dl>
<ul>
<li>Check if PPK bits are valid or not by reading the EFUSE bits</li>
<li>Check if valid PPK hash is all zeros </li>
</ul>

<p>References <a class="el" href="xloader__auth__enc_8h.html#a1f284fd6c101bd12f2c987bad6d3fead">XLoader_AdditionalPpkSelect()</a>, <a class="el" href="xloader__secure_8h.html#aa233d1265392f76e260ac09c0d16c8f8">XLOADER_EFUSE_MISC_CTRL_OFFSET</a>, <a class="el" href="xloader__auth__enc_8h.html#aee4c60ab11405915bf756b014a452bb1">XLOADER_EFUSE_MISC_CTRL_PPK0_INVLD</a>, <a class="el" href="xloader__auth__enc_8h.html#adb12b00725128c38e22aba1601d58cea">XLOADER_EFUSE_MISC_CTRL_PPK1_INVLD</a>, <a class="el" href="xloader__auth__enc_8h.html#a6d227eae10bf8cbde9078247421f4a49">XLOADER_EFUSE_MISC_CTRL_PPK2_INVLD</a>, <a class="el" href="xloader__secure_8h.html#a9c37bf573525769b2821bf9c45858c08">XLOADER_EFUSE_PPK0_START_OFFSET</a>, <a class="el" href="xloader__secure_8h.html#a0281b00807125a658c2dde0ccc8f7925">XLOADER_EFUSE_PPK1_START_OFFSET</a>, <a class="el" href="xloader__secure_8h.html#a54f0e6680ef984f607e3c90dbc869f0e">XLOADER_EFUSE_PPK2_START_OFFSET</a>, <a class="el" href="xloader__auth__enc_8h.html#a7a8c3960502d8e632bb4f58a96bdf420">XLOADER_EFUSE_PPK_HASH_LEN</a>, <a class="el" href="xloader__auth__enc_8h.html#a85aba33b166080b4874c0f5657589b3ea30c391db43ae98a9e08ced025b288346">XLOADER_PPK_SEL_0</a>, <a class="el" href="xloader__auth__enc_8h.html#a85aba33b166080b4874c0f5657589b3ea5e7648e6ffd05aecd35eb09e9c7f4b64">XLOADER_PPK_SEL_1</a>, <a class="el" href="xloader__auth__enc_8h.html#a85aba33b166080b4874c0f5657589b3ea1e9d03724d2fcd2382d74dc002109545">XLOADER_PPK_SEL_2</a>, <a class="el" href="xloader__plat__secure_8h.html#ae8e595a7e8a42347e6c48aee19445f10a59f3f72bbfcc50dac7644dabc9019c4d">XLOADER_SEC_PPK_HASH_ALLZERO_INVLD</a>, and <a class="el" href="xloader__plat__secure_8h.html#ae8e595a7e8a42347e6c48aee19445f10a75d1e5b05feb9947b5321d0306b612d1">XLOADER_SEC_PPK_INVALID_BIT_ERR</a>.</p>

<p>Referenced by <a class="el" href="xloader__plat__secure_8c.html#a257b3dbbc96ac1826e77aca54f99693c">XLoader_IsAdditionalPpkValid()</a>.</p>

</div>
</div>
<a class="anchor" id="aa912487046c04b1c90ca418a19ac3e0d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int XLoader_ProcessAuthEncPrtn </td>
          <td>(</td>
          <td class="paramtype">XLoader_SecureParams *&#160;</td>
          <td class="paramname"><em>SecurePtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>DestAddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>BlockSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u8&#160;</td>
          <td class="paramname"><em>Last</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function performs authentication and decryption of the partition. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">SecurePtr</td><td>is pointer to the XLoader_SecureParams instance </td></tr>
    <tr><td class="paramname">DestAddr</td><td>is the address to which data is copied </td></tr>
    <tr><td class="paramname">BlockSize</td><td>is size of the data block to be processed which doesn't include padding lengths and hash </td></tr>
    <tr><td class="paramname">Last</td><td>notifies if the block to be processed is last or not</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>XST_SUCCESS on success.</li>
<li>XLOADER_ERR_DMA_TRANSFER if DMA transfer fails while copying.</li>
<li>XLOADER_ERR_PRTN_DECRYPT_FAIL if partition decryption fails.</li>
<li>XLOADER_SEC_BUF_CLEAR_SUCCESS if successfully cleared buffer.</li>
<li>XLOADER_SEC_BUF_CLEAR_ERR if failed to clear buffer. </li>
</ul>
</dd></dl>
<ul>
<li>Process the 1st block</li>
<li>Verify encrypted partition is revoked or not</li>
<li>Verify hash</li>
<li>If encryption is enabled, decrypt the data. </li>
</ul>

<p>References <a class="el" href="xloader__secure_8c.html#a31df7acaead3af0dfa1735979d3cee12">XLoader_GetTempParams()</a>, <a class="el" href="xloader__auth__enc_8h.html#a691eab17fa691edd1ab22f5c550a28f4">XLOADER_SECURE_HDR_TOTAL_SIZE</a>, and <a class="el" href="xloader__secure_8c.html#a5054d79a7dcc052ae83d997f183c8779">XLoader_SecureChunkCopy()</a>.</p>

<p>Referenced by <a class="el" href="xloader__auth__enc_8h.html#a5aef75ed3205f50c75189b7c46099856">XLoader_SecureAuthInit()</a>, and <a class="el" href="xloader__auth__enc_8h.html#a9df696fd17dec50576f817a1cd1f7105">XLoader_SecureEncInit()</a>.</p>

</div>
</div>
<a class="anchor" id="ac4b3b88f124856db12efa0ce4d6c81d0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int XLoader_ReadAndVerifySecureHdrs </td>
          <td>(</td>
          <td class="paramtype">XLoader_SecureParams *&#160;</td>
          <td class="paramname"><em>SecurePtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">XilPdi_MetaHdr *&#160;</td>
          <td class="paramname"><em>MetaHdr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function authenticates and/or decrypts the image headers and partition headers and copies the contents to the corresponding structures. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">SecurePtr</td><td>Pointer to the XLoader_SecureParams instance. </td></tr>
    <tr><td class="paramname">MetaHdr</td><td>Pointer to the Meta header table.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>XST_SUCCESS on success.</li>
<li>XLOADER_ERR_HDR_GET_DMA if acquiring DMA fails.</li>
<li>XLOADER_ERR_HDR_AES_OP_FAIL if AES initialization fails.</li>
<li>XLOADER_ERR_METAHDR_LEN_OVERFLOW on meta header length overflow.</li>
<li>XLOADER_ERR_HDR_COPY_FAIL on IH/PH header copy fail.</li>
<li>XLOADER_ERR_SEC_IH_READ_FAIL on image header read fail.</li>
<li>XLOADER_ERR_SEC_IH_VERIFY_FAIL on image header verify fail.</li>
<li>XLOADER_ERR_HDR_NOT_SECURE if neither authentication nor encryption is enabled for IH/PH.</li>
<li>XLOADER_ERR_SEC_PH_READ_FAIL if partition header read fails.</li>
<li>XLOADER_ERR_SEC_PH_VERIFY_FAIL if partition header verification fails. </li>
</ul>
</dd></dl>
<ul>
<li>Initialize AES driver</li>
<li>Validate Meta header length</li>
<li>Read headers to a buffer</li>
<li>Read IHT and PHT to buffers along with encryption overhead</li>
<li>Authenticate headers and decrypt the headers</li>
<li>Decrypt the headers</li>
<li>Read IHT and PHT to structures and verify checksum</li>
<li>Verify Meta header is revoked or not</li>
<li>Update buffer address to point to PHs</li>
<li>Authenticate Image headers and partition headers </li>
</ul>

<p>References <a class="el" href="xloader__auth__enc_8h.html#abf854bbd429c87a80e3a56f61abfd265">XLOADER_AUTH_CERT_MIN_SIZE</a>, <a class="el" href="xloader__secure_8c.html#a31df7acaead3af0dfa1735979d3cee12">XLoader_GetTempParams()</a>, and <a class="el" href="xloader__plat_8h.html#a3944db2060fd83c89b79580dd0caa0de">XLOADER_SECURE_CHUNK_SIZE</a>.</p>

</div>
</div>
<a class="anchor" id="ac13109c8130393c4720ee21b03509e73"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int XLoader_RsaPssSignVerify </td>
          <td>(</td>
          <td class="paramtype">XPmcDma *&#160;</td>
          <td class="paramname"><em>PmcDmaInstPtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u8 *&#160;</td>
          <td class="paramname"><em>MsgHash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">XSecure_Rsa *&#160;</td>
          <td class="paramname"><em>RsaInstPtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u8 *&#160;</td>
          <td class="paramname"><em>Signature</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function encrypts the RSA signature provided and performs required PSS operations to extract salt and calculates M prime hash and compares with hash obtained from EM. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">PmcDmaInstPtr</td><td>Pointer to DMA instance </td></tr>
    <tr><td class="paramname">MsgHash</td><td>of the data to be authenticated. </td></tr>
    <tr><td class="paramname">RsaInstPtr</td><td>is pointer to the XSecure_Rsa instance. </td></tr>
    <tr><td class="paramname">Signature</td><td>is pointer to RSA signature for data to be authenticated.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>XST_SUCCESS on success.</li>
<li>XLOADER_SEC_MEMSET_ERROR and XLOADER_SEC_RSA_MEMSET_SHA3_ARRAY_FAIL if failed to create memory for RSA SHA3.</li>
<li>XLOADER_SEC_MEMSET_ERROR and XLOADER_SEC_RSA_MEMSET_VARSCOM_FAIL if failed to create memory for RSA varscom.</li>
<li>XLOADER_SEC_RSA_PSS_ENC_BC_VALUE_NOT_MATCHED if failed to match with RSA ENC 0xbc value.</li>
<li>XLOADER_SEC_MASKED_DB_MSB_ERROR if error in RSA EM MSB.</li>
<li>XLOADER_SEC_RSA_PSS_SIGN_VERIFY_FAIL if failed to verify RSA PSS signature.</li>
<li>XLOADER_SEC_EFUSE_DB_PATTERN_MISMATCH_ERROR if failed to verify database in efuse.</li>
<li>XLOADER_SEC_RSA_PSS_HASH_COMPARE_FAILURE if RSA PSS hash is not matched.</li>
<li>XLOADER_SEC_BUF_CLEAR_ERR if failed to clear buffer. </li>
</ul>
</dd></dl>
<ul>
<li>Initialise Buffer variable to store HashMgf and DB.</li>
<li>RSA signature encryption with public key components.</li>
<li>Check for signature encrypted message.</li>
<li>Extract Salt and Generate DB from masked DB and Hash.</li>
<li>XOR MGF output with masked DB from EM to get DB.</li>
<li>Check DB = PS &lt;414 zeros&gt; || 0x01.</li>
<li>Hash on M prime</li>
<li>Compare MPrime Hash with Hash from EM </li>
</ul>

<p>References <a class="el" href="xloader__auth__enc_8h.html#a6bcff18daf58c88499df452799e7bcd5">XLOADER_PARTITION_SIG_SIZE</a>, <a class="el" href="xloader__auth__enc_8c.html#a98ac029ac7965b392e6bb0097876fd94">XLOADER_RSA_EM_MSB_INDEX</a>, <a class="el" href="xloader__auth__enc_8c.html#ab5e43af745222cb78f6a71853c891183">XLOADER_RSA_PSS_MSB_PADDING_MASK</a>, <a class="el" href="xloader__auth__enc_8h.html#a4d1f3cc7abae866a021988424e97f30c">XLOADER_RSA_SIG_EXP_BYTE</a>, <a class="el" href="xloader__plat__secure_8h.html#ae8e595a7e8a42347e6c48aee19445f10a4ec6d45bfbd9812351a79b872ec82115">XLOADER_SEC_EFUSE_DB_PATTERN_MISMATCH_ERROR</a>, <a class="el" href="xloader__plat__secure_8h.html#ae8e595a7e8a42347e6c48aee19445f10af12d05ab9e1e70331c1641f4110f688b">XLOADER_SEC_MASKED_DB_MSB_ERROR</a>, <a class="el" href="xloader__plat__secure_8h.html#ae8e595a7e8a42347e6c48aee19445f10a912c5179463f4dd7364db793172c42b9">XLOADER_SEC_MEMSET_ERROR</a>, <a class="el" href="xloader__plat__secure_8h.html#ae8e595a7e8a42347e6c48aee19445f10a188696a4661e00114b62bd4be4cd27ea">XLOADER_SEC_RSA_MEMSET_SHA3_ARRAY_FAIL</a>, <a class="el" href="xloader__plat__secure_8h.html#ae8e595a7e8a42347e6c48aee19445f10a0b2849b0847f7bb9ba89ab3438f7fb48">XLOADER_SEC_RSA_MEMSET_VARSCOM_FAIL</a>, <a class="el" href="xloader__plat__secure_8h.html#ae8e595a7e8a42347e6c48aee19445f10a8c2efeca862dc87ae82772f998557f80">XLOADER_SEC_RSA_PSS_ENC_BC_VALUE_NOT_MATCHED</a>, <a class="el" href="xloader__plat__secure_8h.html#ae8e595a7e8a42347e6c48aee19445f10a38b3937ac67249d5adf8f9dcce931884">XLOADER_SEC_RSA_PSS_HASH_COMPARE_FAILURE</a>, and <a class="el" href="xloader__plat__secure_8h.html#ae8e595a7e8a42347e6c48aee19445f10a0ef01699836b976cc2498c79b54b4e7e">XLOADER_SEC_RSA_PSS_SIGN_VERIFY_FAIL</a>.</p>

</div>
</div>
<a class="anchor" id="a5aef75ed3205f50c75189b7c46099856"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int XLoader_SecureAuthInit </td>
          <td>(</td>
          <td class="paramtype">XLoader_SecureParams *&#160;</td>
          <td class="paramname"><em>SecurePtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const XilPdi_PrtnHdr *&#160;</td>
          <td class="paramname"><em>PrtnHdr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function initializes authentication parameters of XLoader_SecureParams's instance. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">SecurePtr</td><td>is pointer to the XLoader_SecureParams instance. </td></tr>
    <tr><td class="paramname">PrtnHdr</td><td>is pointer to XilPdi_PrtnHdr instance that has to be processed.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>XST_SUCCESS on success.</li>
<li>XLOADER_ERR_INIT_AC_COPY_FAIL if failed to copy authentication certificate from flash device. </li>
</ul>
</dd></dl>
<ul>
<li>Check if authentication is enabled and copy authentication certificate from PDI source to memory location provided in image header. Also initialize the required SecurePtr members.</li>
</ul>

<p>References <a class="el" href="xloader__auth__enc_8h.html#abf854bbd429c87a80e3a56f61abfd265">XLOADER_AUTH_CERT_MIN_SIZE</a>, <a class="el" href="xloader__secure_8c.html#a31df7acaead3af0dfa1735979d3cee12">XLoader_GetTempParams()</a>, and <a class="el" href="xloader__auth__enc_8c.html#aa912487046c04b1c90ca418a19ac3e0d">XLoader_ProcessAuthEncPrtn()</a>.</p>

<p>Referenced by <a class="el" href="xloader__secure_8h.html#a9410756c2dbe4b6bd6cdfce81a5bd7fa">XLoader_SecureInit()</a>.</p>

</div>
</div>
<a class="anchor" id="a9df696fd17dec50576f817a1cd1f7105"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int XLoader_SecureEncInit </td>
          <td>(</td>
          <td class="paramtype">XLoader_SecureParams *&#160;</td>
          <td class="paramname"><em>SecurePtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const XilPdi_PrtnHdr *&#160;</td>
          <td class="paramname"><em>PrtnHdr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function initializes encryption parameters of XLoader_SecureParams's instance. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">SecurePtr</td><td>is pointer to the XLoader_SecureParams instance. </td></tr>
    <tr><td class="paramname">PrtnHdr</td><td>is pointer to XilPdi_PrtnHdr instance that has to be processed.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>XST_SUCCESS on success.</li>
<li>XLOADER_ERR_INIT_CHECKSUM_INVLD_WITH_AUTHDEC if both checksum and authentication or encryption are enabled.</li>
<li>XLOADER_ERR_PRTN_DECRYPT_NOT_ALLOWED if Partition is not allowed to be encrypted if State of boot is non secure.</li>
<li>XLOADER_ERR_GLITCH_DETECTED if glitch is detected.</li>
<li>XLOADER_ERR_PRTN_ENC_ONLY_KEYSRC on invalid key source when only encryption is enabled. </li>
</ul>
</dd></dl>
<ul>
<li>Check if encryption is enabled</li>
<li>Error out if checksum is enabled along with authentication or encryption.</li>
<li>Run AES Kat test if the image is encrypted and metaheader is not encrypted</li>
<li>Check secure state of boot as partition is allowed to be encrypted only if Secure state of boot is S-HWRoT, Emul S-HWRoT, A-HWRoT or Emul A-HWRoT.</li>
<li>Check Secure State of the device. If S-HWRoT is enabled, then validate keysrc</li>
</ul>

<p>References <a class="el" href="xloader__auth__enc_8h.html#aa5719aab46c8fcdb925a9d488c776cc1">XLOADER_BBRAM_KEY</a>, <a class="el" href="xloader__auth__enc_8h.html#a03ec82dda650d2b8fb4249e30ff395e2">XLOADER_EFUSE_KEY</a>, <a class="el" href="xloader__secure_8c.html#a3e99458db1239a8f1bcb70eee9025232">XLoader_GetAHWRoT()</a>, <a class="el" href="xloader__secure_8c.html#a27d4a7f2cecd7b051a5418ad7586cac3">XLoader_GetSHWRoT()</a>, <a class="el" href="xloader__secure_8c.html#a31df7acaead3af0dfa1735979d3cee12">XLoader_GetTempParams()</a>, and <a class="el" href="xloader__auth__enc_8c.html#aa912487046c04b1c90ca418a19ac3e0d">XLoader_ProcessAuthEncPrtn()</a>.</p>

<p>Referenced by <a class="el" href="xloader__secure_8h.html#a9410756c2dbe4b6bd6cdfce81a5bd7fa">XLoader_SecureInit()</a>.</p>

</div>
</div>
<a class="anchor" id="a7d852b900fa863fa8719bba0e2699423"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int XLoader_SecureValidations </td>
          <td>(</td>
          <td class="paramtype">const XLoader_SecureParams *&#160;</td>
          <td class="paramname"><em>SecurePtr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function checks if authentication/encryption is compulsory. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">SecurePtr</td><td>is pointer to the XLoader_SecureParams instance.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>XST_SUCCESS on success.</li>
<li>XLOADER_ERR_GLITCH_DETECTED if glitch is detected.</li>
<li>XLOADER_ERR_AUTH_EN_PPK_HASH_ZERO if PPK not programmed and authentication is enabled</li>
<li>XLOADER_ERR_HWROT_EFUSE_AUTH_COMPULSORY if PPK Programmed but eFuse authentication is disabled.</li>
<li>XLOADER_ERR_ENCONLY_ENC_COMPULSORY if encryption is disabled.</li>
<li>XLOADER_ERR_METAHDR_KEYSRC_MISMATCH if metaheader Key Source does not match PLM Key Source. </li>
</ul>
</dd></dl>
<ul>
<li>Check Secure State of device if A-HWROT is enabled then authentication is mandatory for metaheader and BHDR authentication must be disabled.</li>
<li>Check Secure State of the device. If S-HWRoT is enabled, then metaheader must be encrypted.</li>
<li>Verify if Metaheader encryption key source for FPDI/PPDI is same as PLM Key source in Bootheader.</li>
</ul>

<p>References <a class="el" href="xloader__secure_8c.html#a3e99458db1239a8f1bcb70eee9025232">XLoader_GetAHWRoT()</a>, <a class="el" href="xloader__secure_8c.html#a27d4a7f2cecd7b051a5418ad7586cac3">XLoader_GetSHWRoT()</a>, and <a class="el" href="xloader__secure_8c.html#a31df7acaead3af0dfa1735979d3cee12">XLoader_GetTempParams()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
	<p class="footer">&copy; Copyright 2015-2022 Xilinx, Inc. All Rights Reserved.</p>
	<p class="footer">&copy; Copyright 2022-2023 Advanced Micro Devices, Inc. All Rights Reserved.</p>
</div>
</body>
</html>
